# cargo-nextest configuration for cass
# https://nexte.st/book/configuration.html

# No custom store directory - use workspace-relative paths

# =============================================================================
# Default Profile - Development
# =============================================================================
[profile.default]
# Fail fast during local development
fail-fast = true
# Run tests in parallel (default: number of CPUs)
test-threads = "num-cpus"
# Output format for local development
status-level = "pass"
final-status-level = "fail"
# Retry configuration
retries = 0
# Slow test thresholds
slow-timeout = { period = "30s", terminate-after = 2 }

# =============================================================================
# CI Profile - Continuous Integration
# =============================================================================
[profile.ci]
# Don't fail fast in CI - run all tests to get complete results
fail-fast = false
# Use all CPUs
test-threads = "num-cpus"
# Verbose output for CI logs
status-level = "all"
final-status-level = "all"
# Retry flaky tests once in CI
retries = 1
# Longer timeout for CI (may be slower)
slow-timeout = { period = "60s", terminate-after = 2 }

# JUnit XML output for CI integration
[profile.ci.junit]
# Output path for JUnit XML report (relative to store dir)
path = "junit.xml"
# Report name shown in CI systems
report-name = "cass-test-results"
# Store output on failure for debugging
store-success-output = false
store-failure-output = true

# =============================================================================
# CI Coverage Profile - Coverage runs
# =============================================================================
[profile.ci-coverage]
# Same settings as CI
fail-fast = false
test-threads = "num-cpus"
status-level = "all"
final-status-level = "all"
retries = 0
slow-timeout = { period = "120s", terminate-after = 2 }

[profile.ci-coverage.junit]
path = "junit.xml"
report-name = "cass-coverage-test-results"
store-success-output = false
store-failure-output = true

# =============================================================================
# E2E Profile - End-to-end tests (sequential)
# =============================================================================
[profile.e2e]
# Don't fail fast - run all E2E tests
fail-fast = false
# E2E tests often need sequential execution
test-threads = 1
status-level = "all"
final-status-level = "all"
retries = 1
# E2E tests may take longer
slow-timeout = { period = "120s", terminate-after = 2 }

[profile.e2e.junit]
path = "junit.xml"
report-name = "cass-e2e-test-results"
store-success-output = false
store-failure-output = true

# =============================================================================
# Test Filtering
# =============================================================================
# Skip install script tests by default (they need network access)

# =============================================================================
# Override Settings for Specific Tests
# =============================================================================
# Tests that should run with limited parallelism (e.g., TUI tests)
# Using threads-required to serialize UI tests that need exclusive terminal access
[[profile.default.overrides]]
filter = "test(ui_)"
threads-required = "num-cpus"

[[profile.ci.overrides]]
filter = "test(ui_)"
threads-required = "num-cpus"
