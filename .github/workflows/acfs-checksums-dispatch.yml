name: Notify ACFS checksum monitor

on:
  push:
    branches: [main, master]
    paths:
      - 'install.sh'
      - 'scripts/install.sh'
  release:
    types: [published]
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  dispatch:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      ACFS_TOKEN: ${{ secrets.ACFS_REPO_DISPATCH_TOKEN }}
    steps:
      - name: Skip dispatch when token missing
        if: ${{ env.ACFS_TOKEN == '' }}
        run: echo "ACFS_REPO_DISPATCH_TOKEN not set; skipping ACFS dispatch."
      - name: Dispatch to ACFS
        if: ${{ env.ACFS_TOKEN != '' }}
        uses: peter-evans/repository-dispatch@ff45666b9427631e3450c54a1bcbee4d9ff4d7c0 # v3
        with:
          token: ${{ env.ACFS_TOKEN }}
          repository: Dicklesworthstone/agentic_coding_flywheel_setup
          event-type: upstream-changed
          client-payload: |
            {"repo":"${{ github.repository }}","ref":"${{ github.ref }}","sha":"${{ github.sha }}","event":"${{ github.event_name }}"}
